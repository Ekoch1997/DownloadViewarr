document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementsByTagName("script");let t=null;for(let n of e)if(n.src.includes("downloadviewarr_button.js")){t=n;break}if(!t)return console.error("Error: Script tag for 'downloadviewarr_button.js' could not be found.");const o=t.getAttribute("downloadviewarr-url");if(!o)return console.error("Error: 'downloadviewarr-url' attribute is missing or cannot be read.");const l=t.getAttribute("color")||"#e5a00d",n=document.createElement("style");n.innerHTML=`.floating-btn{position:fixed;bottom:20px;left:20px;color:white;border:none;border-radius:50%;width:50px;height:50px;display:flex;align-items:center;justify-content:center;font-size:24px;cursor:pointer;z-index:9999;transition:all .3s ease;overflow:visible}.floating-btn::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background-color:${l};z-index:-1;transition:filter .3s ease;border-radius:50%}.floating-btn:hover::before{filter:brightness(75%)}.floating-btn:hover::after{content:'View the current download queue';position:absolute;top:50%;left:calc(100% + 10px);transform:translateY(-50%);background-color:#333;color:#fff;padding:5px 10px;border-radius:5px;font-size:12px;white-space:nowrap;z-index:10000;box-shadow:0px 4px 6px rgba(0, 0, 0, 0.1)}svg.fltbutt-icon{width:32px;height:32px;fill:white;pointer-events:none;transform:translate(1px, -1px)}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0, 0, 0, 0.5);align-items:center;justify-content:center;z-index:1000}.modal-content{background-color:white;padding:10px 10px 0;border-radius:10px;width:80%;height:80%;overflow:hidden;display:flex;flex-direction:column;border:0}.modal-content iframe{width:100%;height:calc(100% - 50px);border-radius:10px 10px 0 0;border:none}.close-btn{background-color:${l};color:white;border:none;border-radius:0 0 10px 10px;padding:10px 0;cursor:pointer;font-size:14px;width:100%;align-self:flex-end;margin:0}.close-btn:hover{filter:brightness(75%)}`,document.head.appendChild(n),document.body.insertAdjacentHTML("beforeend",'<button class="floating-btn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="fltbutt-icon"><path d="M537.6 226.6c4.1-10.7 6.4-22.4 6.4-34.6 0-53-43-96-96-96-19.7 0-38.1 6-53.3 16.2C367 64.2 315.3 32 256 32c-88.4 0-160 71.6-160 160 0 2.7.1 5.4.2 8.1C40.2 219.8 0 273.2 0 336c0 79.5 64.5 144 144 144h368c70.7 0 128-57.3 128-128 0-61.9-44-113.6-102.4-125.4zm-132.9 88.7L299.3 420.7c-6.2 6.2-16.4 6.2-22.6 0L171.3 315.3c-10.1-10.1-2.9-27.3 11.3-27.3H248V176c0-8.8 7.2-16 16-16h48c8.8 0 16 7.2 16 16v112h65.4c14.2 0 21.4 17.2 11.3 27.3z"/></svg></button><div class="modal" id="modal"><div class="modal-content"><iframe id="contentFrame"></iframe><button class="close-btn" id="close-modal">Close</button></div></div>');const d=document.querySelector(".floating-btn"),a=document.getElementById("modal"),i=document.getElementById("close-modal"),c=document.getElementById("contentFrame");function r(){window.location.pathname.startsWith("/login")?d.style.display="none":d.style.display="flex"}d.addEventListener("click",(()=>{c.src=`${o}/index.html`,a.style.display="flex"})),i.addEventListener("click",(()=>{a.style.display="none",c.src=""})),window.addEventListener("click",(e=>{e.target===a&&(a.style.display="none",c.src="")})),new MutationObserver((()=>{r()})).observe(document.body,{childList:!0,subtree:!0}),r(),window.addEventListener("popstate",r),(e=>{const t=document.createElement("div");t.id="floatingQueueBubble",t.style.cssText="position:absolute;top:-3px;right:-3px;background-color:#b0e57c;color:#1a1a1a;border-radius:50%;width:20px;height:20px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:bold;z-index:10001;display:none;",d.appendChild(t);const updateQueueStatus=async()=>{try{const n=await fetch(`${e}/api/queue/downloading`);if(!n.ok)throw new Error("Failed to fetch queue count");const{total:o}=await n.json();if(o>0){t.textContent=o,t.style.display="flex";let originalTitle=document.title.replace(/\s游릭$/,"");document.title=originalTitle+" 游릭"}else t.style.display="none",document.title=document.title.replace(/\s游릭$/,"")}catch(e){console.error("Error fetching queue count:",e),t.style.display="none",document.title=document.title.replace(/\s游릭$/,"")}};updateQueueStatus(),setInterval(updateQueueStatus,3e4)})(o)}));
